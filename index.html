<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Budget App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 10px;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            min-height: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        h1 {
            text-align: center;
            font-weight: normal;
            margin-bottom: 20px;
        }

        .total-display {
            background-color: red;
            color: black;
            font-size: 40px;
            text-align: center;
            padding: 15px;
            margin: 0 auto 30px auto;
            width: 150px;
            border-radius: 2px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 60px;
        }

        th {
            border-bottom: 2px solid black;
            padding: 5px;
            font-size: 16px;
            text-align: center;
        }

        /* Adjusted Column Widths for 5 columns */
        th:nth-child(1) { width: 10%; } /* No. */
        th:nth-child(2) { width: 28%; } /* Date */
        th:nth-child(3) { width: 32%; } /* Item */
        th:nth-child(4) { width: 20%; } /* Amount */
        th:nth-child(5) { width: 10%; } /* Delete Icon */

        td {
            border-bottom: 1px solid #ccc;
            padding: 10px 2px;
            height: 40px; /* Fixed height to prevent jumping */
        }

        /* Highlight the selected row */
        tr.selected {
            background-color: #f9f9f9;
        }

        input {
            width: 100%;
            border: none;
            font-size: 14px;
            text-align: center;
            background: transparent;
            outline: none;
            box-sizing: border-box;
        }

        /* Delete Button Styling */
        .delete-btn {
            background: none;
            border: none;
            color: red;
            font-size: 18px;
            cursor: pointer;
            display: none; /* Hidden by default */
            width: 100%;
        }

        /* Only show delete button when row has 'selected' class */
        tr.selected .delete-btn {
            display: block;
        }

        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: auto;
            padding-top: 20px;
        }

        button.main-btn {
            background-color: black;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 14px;
            border-radius: 20px;
            cursor: pointer;
            text-transform: uppercase;
        }

        button.main-btn:active {
            opacity: 0.8;
        }
    </style>
</head>
<body>

    <div class="app-container">
        <h1>Food Budget</h1>

        <div class="total-display" id="totalBox">0</div>

        <table id="expenseTable">
            <thead>
                <tr>
                    <th>No.</th>
                    <th>Date</th>
                    <th>Item</th>
                    <th>Amount</th>
                    <th></th> </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>

        <div class="button-container">
            <button class="main-btn" onclick="addNewRow()">ADD ROW</button>
            <button class="main-btn" onclick="saveData()">SAVE</button>
        </div>
    </div>

    <script>
        window.onload = function() {
            loadData();
        };

        function calculateTotal() {
            let total = 0;
            const amounts = document.querySelectorAll('.amount-input');
            amounts.forEach(input => {
                const val = parseFloat(input.value);
                if (!isNaN(val)) total += val;
            });
            document.getElementById('totalBox').innerText = total;
        }

        // Function to handle row selection (Show/Hide delete button)
        function selectRow(rowElement) {
            // Remove 'selected' class from all other rows
            const allRows = document.querySelectorAll('#tableBody tr');
            allRows.forEach(r => r.classList.remove('selected'));
            
            // Add 'selected' class to the clicked row
            rowElement.classList.add('selected');
        }

        function addNewRow(dateVal = '', itemVal = '', amountVal = '') {
            const tableBody = document.getElementById('tableBody');
            const rowCount = tableBody.rows.length + 1;
            const row = document.createElement('tr');
            
            // Add click event to the entire row to trigger selection
            row.onclick = function() { selectRow(this); };

            let defaultDate = dateVal;
            if (!defaultDate) {
                const today = new Date();
                defaultDate = today.toISOString().split('T')[0];
            }

            row.innerHTML = `
                <td class="row-num" style="text-align:center;">${rowCount}</td>
                <td><input type="date" class="date-input" value="${defaultDate}"></td>
                <td><input type="text" class="item-input" placeholder="Name" value="${itemVal}"></td>
                <td><input type="number" class="amount-input" placeholder="0" value="${amountVal}" oninput="calculateTotal()"></td>
                <td style="text-align:center;">
                    <button class="delete-btn" onclick="deleteRow(this)">üóëÔ∏è</button>
                </td>
            `;

            tableBody.appendChild(row);
            
            // Automatically select the new row
            selectRow(row);
        }

        function deleteRow(btn) {
            // Get the row (tr) that contains the button
            const row = btn.parentNode.parentNode;
            
            // Remove the row
            row.remove();
            
            // Re-calculate the numbers (1, 2, 3...)
            renumberRows();
            
            // Re-calculate total money
            calculateTotal();
            
            // Stop the click from bubbling up (prevents selecting the deleted row)
            event.stopPropagation();
        }

        function renumberRows() {
            const rows = document.querySelectorAll('#tableBody tr');
            rows.forEach((row, index) => {
                row.querySelector('.row-num').innerText = index + 1;
            });
        }

        function saveData() {
            const rows = document.querySelectorAll('#tableBody tr');
            let data = [];

            rows.forEach(row => {
                const date = row.querySelector('.date-input').value;
                const item = row.querySelector('.item-input').value;
                const amount = row.querySelector('.amount-input').value;
                
                if(date || item || amount) {
                    data.push({ date, item, amount });
                }
            });

            localStorage.setItem('foodBudgetApp', JSON.stringify(data));
            alert('Data Saved!');
        }

        function loadData() {
            const storedData = localStorage.getItem('foodBudgetApp');
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';

            if (storedData) {
                const data = JSON.parse(storedData);
                if (data.length > 0) {
                    data.forEach(item => {
                        addNewRow(item.date, item.item, item.amount);
                    });
                } else {
                    addNewRow(); 
                }
            } else {
                addNewRow(); 
            }
            calculateTotal(); 
        }
    </script>
</body>
</html>
